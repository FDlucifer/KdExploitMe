#pragma once
#include "stdafx.h"
#include "Helpers.h"

BOOL VersionCheck(UINT32 maxMajorVersion, UINT32 maxMinorVersion, UINT32 minMajorVersion, UINT32 minMinorVersion, ArchitectureType architectureRequired)
{
	OSVERSIONINFO osVersionInfo = { 0 };
	osVersionInfo.dwOSVersionInfoSize = sizeof(osVersionInfo);

	if (!GetVersionEx(&osVersionInfo))
	{
		//printf("- Error: Unable to call GetVersionEx.\n");
		return false;
	}

	if (!(osVersionInfo.dwMajorVersion >= minMajorVersion && osVersionInfo.dwMajorVersion <= maxMajorVersion))
	{
		//printf(" - Attempting to run exploit on unsupported OS version.\n");
		return false;
	}


	if (!((osVersionInfo.dwMajorVersion == minMajorVersion && osVersionInfo.dwMinorVersion >= minMinorVersion)
		|| (osVersionInfo.dwMajorVersion == maxMajorVersion && osVersionInfo.dwMinorVersion <= maxMinorVersion)))
	{
		//printf(" - Attempting to run exploit on unsupported OS version.\n");
		return false;
	}

#ifdef _WIN64
	if (!(architectureRequired == AnyArchitecture || architectureRequired == AMD64))
	{
		//printf(" - Attempting to run exploit on unsupported OS version.\n");
		return false;
	}
#else
	if (!(architectureRequired == AnyArchitecture || architectureRequired == X86))
	{
		//printf(" - Attempting to run exploit on unsupported OS version.\n");
		return false;
	}
#endif

	return true;
}